(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-93ce8030"],{"0a4a":function(e,t,a){"use strict";var s=a("ad69"),r=a.n(s);r.a},1959:function(e,t,a){e.exports=a.p+"img/send.44d4aba5.png"},"32a5":function(e,t,a){},"346b":function(e,t,a){"use strict";var s=a("7d76"),r=a.n(s);r.a},"3c04":function(e,t,a){},"4b89":function(e,t,a){"use strict";var s=a("d1e8"),r=a.n(s);r.a},"4d51":function(e,t,a){"use strict";var s=a("d08b"),r=a.n(s);r.a},"4da8":function(e,t,a){},"651c":function(e,t,a){"use strict";var s=a("de72"),r=a.n(s);r.a},"71db":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAACXBIWXMAAAsTAAALEwEAmpwYAAANcklEQVR42u3WIU5cUQCG0UkaHKZbKAgEjuDqBsUK2AKKndTVsYKmosHhGNhEN1CLIgTFcFNbQksyTea975zkX8G7975vsQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgL76PXZlNdOcbugefPQVAzePY2myi+7qhe3AzduE5AASAWSsAVmPPIgAQAGa9AFiLAEAAmDUDQAQAAsAsGgAiABAAZtEAEAGAADCLBoAIAASAWTQARAAgAMyiASACAAFgFg0AEQAIALNoAIgAQACYRQNABAACwCwaACIAEABm0QAQAYAAMIsGgAgABIBZNABEACAAzKIBIAIAAWAWDQARAAgAs2gAiABAAJhFA0AEAALALBoAIgAQAGbRABABgAAwiwaACAAEgFk0AEQAIADMogEgAgABYBYNABEACACzaACIAEAAmEUDQAQAAsAsGgAiABAAZtEAEAGAADCLBoAIAASAWTQARAAgAMyiASACAAFgFg0AEQAIALNoAIgAQACYRQNABAACwCwaACIAEABm0QAQAYAAMIsGgAgABIBZNABEACAAzKIBIAIAAWAWDQARAAgAs2gAiABAAJhFA0AEAALALBoAIgAQACYAogEgAgABYAIgGgAiABAAJgCiASACAAFgAiAaACIAEAAmAKIBIAIAAWACIBoAIgAQACYAogEgAgABYALgHY7GTma05diO5w0QACYAABAAJgAABICfiAkAAAFgJgAABICZAAAQAGYCAEAAmAkAAAFgJgAABICZAAAQAGYCAEAAmAkAAAFgJgAABICZAAAQAGYCAEAAmAkAAAFgAgCA9/k1dm+/9+CHOrldjn20V/fB8wbwb3bHbv1UbSY7dqUBRIAJAABEgAkAAESACQAARIAJAAARIAJMAACIADMBACACzAQAgAgwEwAAIsBMAACIADMBACACzAQAgAgwEwAAIsBMAACIADMBACACzAQAgAgwEwAAIsBMAACIABMAAIgAEwAAiAATAACIABMAAIgAEwAAiAATAACIABMAAIgAEwAAiAATAACIABMAAIgAEwAAIsAPywQAgAgwEwAAIsBMAACIADMBACACzAQAgAgwEwA1B2MrswlvuaG7cCoCzARAybEDbxPf2YbuwpMIMBMAAsCsFwBrEWAmAASAWTMARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQARIAJAASAWTQA5hYBP51VAYAAMBMAvQi4dlYFAALATAD0IkAACAAEgJkACEaAABAACAAzARCMAAEgABAAZgIgGAECQAAgAMwEQDACBIAAQACYCYBgBAgAAYAAMBMAwQgQAAIAAWAmAIIRIAAEAALATAAEI0AACAAEgJkACEaAABAACAAzARCMAAEgABAAZgIgGAECQAAgAMwEQDACBIAAQACYbWUAHM1shwLABAACwAQAAsAEAALABAACwASAAHDgTQAgAEwACAAzAYAAEAAIADMBgAAQAAgAMwGAABAACAAzAYAAEAAIADMBgAAQAAgAMwGAABAACAAzASAATAAgAMwEgAAwAYAAMBMAAsAEAALATAAIABMACAAzASAATAAgAMwEgAAwAYAAMAGAADABgACw1i7G9uyPfRIAJgAQAGa9PQoAEwAIADMBIABMACAAzASAADABIAAceDMBIABMAAgAMxMAAkAAIADMTAAIAAGAADAzASAABAACwMwEgAAQAAgAMxMAAkAAIADMTAAIAAGAADAzAWACAAFgZgLABAACwMwEgAkABICZCQATAAgAMxMAJgAQAGYmAEwAIADMTACYAEAAmJkAMAGAADATAALABAACwEwACAATAAgAMwEgAEwACAAzEwACQAAgAMxMAAgAAYAAMDMBIAAEAALAzASAABAACAAzEwACQAAgAMxMAAgAAYAAMDMB4LsIAASAmQkAEwAIADMTACYAEABmJgBMACAAzEwAmABAAJiZADABgAAwMwFgAgABYGYCwAQAAsBMAAgAEwAIADMBIABMACAAzASAADABIADMTAAIAAGAADAzASAABAACwMwEgAAQAAgAMxMAAkAAIADMTAAIAAGAADAzASAABAACwMwEgG8iABAAZiYATAAgAMxMAJgAQACYmQAwAYAAMDMBYAIAAWBmAsAEAALAzASACQAEgJkJABMACAAzASAATAAgAMwEgAAwAYAAMBMAAsAEgAAwMwEgAEwACAAzEwACQAAgAMxMAAgAAYAAMDMBIAAEAALAzASAABAACAAzEwACQAAgAMxMAAgAAYAAMDMBYAIAAWBmAsAEAALAzASACQAEgJkJABMACAAzEwAmABAAZiYATAAgAMxMAJgAQACYCQABYAIAAWAmAASACQAEgJkAEAAmAASAmQkAAWACQACYmQAQAAIAAWBmAkAACAAEgJkJAAEgABAAZiYABIAAQACYmQAQAAIAAWBmAkAACAAEgJkJABMACAAzEwAmABAAZiYATAAgAMxMAJgAQACYmQAwAYAAMDMBYAIAAWBmAsAEAALATAAIABMACAAzASAATAAgAMwEgAAwASAAHHgzASAATAAIADMTAAJAACAAzEwACAABgAAwMwEgAAQAAsDMBIAAEAAIADMTAAJAACAAzEwACAABgAAwMwFgAgABYGYCwAQAAsDMBIAJAASAmQkAEwAIADMTACYAEABmJgBMACAAzEwAmABAAJiZADABgAAwEwACwAQAAsBMAAgAEwAIADMBIABMAAgAMxMAAkAAIADMTAAIAAGAADAzASAABAACwMwEgAAQAAgAMxMAAkAAIADMTAAIAAGAADAzAeC7CAAEgJkJABMACAAzEwAmABAAZiYATAAgAMxMAJgAQACYmQAwAYAAMDMBYAIAAWBmAsAEAALATAAIABMACAAzASAATAAgAMwEgAAwASAAzEwACAABgAAwMwEgAAQAAsDMBIAAEAAIADMTAAJAACAAzEwACAABgAAwMwEgAAQAAsDMBIBvIgAQAGYmAEwAIADMTACYAEAAmJkAMAGAADAzAWACAAFgZgLABAACwMwEgAkABICZCQATAAgAMwEgAEwAIADMBIAAMAGAADATAALABIAAMDMBIABMAAgAMxMAAkAAIADMTAAIAAGAADAzASAABAACwMwEgAAQAAgAMxMAAkAAIADMTAAIAAGAADAzAWACAAFgZgLABAACwMwEgAkABICZCQATAAgAMxMAJgAQAGYmAEwAIADMTACYAEAAmAkAAWACAAFgJgAEgAkABICZABAAJgAEgJkJgP/sy9idbf0O/BYFgJkJAEAAmJkAAASAmQkAQACYmQAABICZCQBAAJiZAAAEgJkJAEAAmJkAAASAmQkAQACYmQAABICZCQBAAJiZAAAEgJkJAEAAmAkAAAFgJgAABICZAAAEgJkJAEAAmJkAAASAmQkAQACYmQAABICZCQBAAJiZAAAEgJkJAEAAmJkAAASAmQkAQACYmQAABICZCQBAAJiZAAAEgJkJAEAAmJkAAASAmQAAEABmAgBAAJgJAEAAeCzNBAAgAMxMAAACwMwEACAAzEwAAALAzAQAIADMTAAAAsDMBAAgAMxMAAACwMwEACAAzEwAAALAzAQAIADMTAAAAsDMBAAgAMxMAAACwMwEACAAzAQAgAAwEwAAAsBMAAACwMwEACAAzEwAAALAzAQAIADMTAAAAsDMBAAgAMxMAAACwMwEACAAzEwAAALAzAQAIADMTAAAAsDMBAAgAMxMAAACwMwEACAAzEwAAALATAAACAAzAQAgAMwEACAAzEwAAALAzAQAIADMTAAAAsDMBAAgAMxMAAACwMwEACAAzEwAAALAzAQAIADMTAAAAsDMBAAgAMxMAAACwMwEACAAzEwAAALAzAQAIADMBACAADATAAACwEwAAALAzAQAIADMTAAAAsDMBAAgAMxMAAACwMwEACAAzEwAAALAzAQAIADMTAAAAsDMBAAgAMxMAAACwMwEACAAzEwAAALAzAQAIADMTAAAAsBMAAAIADMBACAAzAQAIADMTAAAAsDMBAAgAMxMAAAzsz/2w8xmt2+eNwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA3vQA0ZndE4zOsUwAAAABJRU5ErkJggg=="},"745f":function(e,t,a){"use strict";var s=a("d0f8"),r=a.n(s);r.a},"7cec":function(e,t,a){"use strict";var s=a("32a5"),r=a.n(s);r.a},"7d76":function(e,t,a){},"7e05":function(e,t,a){"use strict";var s=a("9fa3"),r=a.n(s);r.a},"8d4d":function(e,t,a){"use strict";var s=a("3c04"),r=a.n(s);r.a},"94df":function(e,t,a){"use strict";const s=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],r=["B","kiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],i=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],n=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],o=(e,t,a)=>{let s=e;return"string"===typeof t||Array.isArray(t)?s=e.toLocaleString(t,a):!0!==t&&void 0===a||(s=e.toLocaleString(void 0,a)),s};e.exports=(e,t)=>{if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t=Object.assign({bits:!1,binary:!1},t);const a=t.bits?t.binary?n:i:t.binary?r:s;if(t.signed&&0===e)return" 0 "+a[0];const A=e<0,c=A?"-":t.signed?"+":"";let u;if(A&&(e=-e),void 0!==t.minimumFractionDigits&&(u={minimumFractionDigits:t.minimumFractionDigits}),void 0!==t.maximumFractionDigits&&(u=Object.assign({maximumFractionDigits:t.maximumFractionDigits},u)),e<1){const s=o(e,t.locale,u);return c+s+" "+a[0]}const l=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),a.length-1);e/=Math.pow(t.binary?1024:1e3,l),u||(e=e.toPrecision(3));const d=o(Number(e),t.locale,u),p=a[l];return c+d+" "+p}},"9fa3":function(e,t,a){},ad69:function(e,t,a){},b244:function(e,t,a){"use strict";var s=a("f5a3"),r=a.n(s);r.a},b6db:function(e,t,a){"use strict";var s=a("ffb1"),r=a.n(s);r.a},c0c8:function(e,t,a){"use strict";var s=a("4da8"),r=a.n(s);r.a},d08b:function(e,t,a){},d0f8:function(e,t,a){},d1e8:function(e,t,a){},de72:function(e,t,a){},ec4d:function(e,t,a){e.exports=a.p+"img/group.55fbffbe.png"},edc5:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"chat",style:{"--bg-image":"url('"+e.background+"')"}},[a("genal-music"),e.visibleTool?a("div",{staticClass:"chat-part1"},[a("genal-tool",{on:{logout:e.logout}})],1):e._e(),a("div",{staticClass:"chat-part2"},[a("genal-search",{on:{addGroup:e.addGroup,joinGroup:e.joinGroup,addFriend:e.addFriend,setActiveRoom:e.setActiveRoom}}),a("genal-room",{on:{setActiveRoom:e.setActiveRoom}})],1),a("div",{staticClass:"chat-part3"},[a("a-icon",{staticClass:"chat-team",attrs:{type:"message"},on:{click:e.toggleDrawer}}),a("div",{staticClass:"chat-tool"},[e.visibleTool?a("a-icon",{attrs:{type:"menu-fold"},on:{click:e.toggleTool}}):a("a-icon",{attrs:{type:"menu-unfold"},on:{click:e.toggleTool}})],1),e.activeRoom?a("genal-message"):e._e()],1),a("a-drawer",{staticStyle:{height:"100%"},attrs:{placement:"left",closable:!1,visible:e.visibleDrawer},on:{close:e.toggleDrawer}},[a("div",{staticClass:"chat-drawer"},[a("genal-search",{on:{addGroup:e.addGroup,joinGroup:e.joinGroup,addFriend:e.addFriend,setActiveRoom:e.setActiveRoom}}),a("genal-room",{on:{setActiveRoom:e.setActiveRoom}})],1)]),a("genal-join",{attrs:{showModal:e.showModal},on:{register:e.handleRegister,login:e.handleLogin}})],1)},r=[],i=(a("96cf"),a("1da1")),n=a("d4ec"),o=a("bee2"),A=a("262e"),c=a("2caf"),u=a("9ab4"),l=a("60a3"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tool"},[a("div",{staticClass:"tool-avatar"},[a("div",{staticClass:"tool-avatar-img",on:{click:function(t){return e.showUserInfo("showUserModal")}}},[e.user?a("img",{attrs:{src:e.user.avatar,alt:""}}):e._e()]),a("div",{staticClass:"tool-avatar-name"},[e._v(e._s(e.user.username))])]),a("a-tooltip",{attrs:{placement:"topLeft","arrow-point-at-center":""}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("div",[e._v("请文明聊天")]),a("div",[e._v("截图粘贴可发送图片")])]),a("a-icon",{staticClass:"tool-tip icon",attrs:{type:"bulb"}})],1),a("a-icon",{staticClass:"tool-skin icon",attrs:{type:"skin"},on:{click:function(t){e.showBackgroundModal=!0}}}),a("a",{staticClass:"tool-github icon",attrs:{href:"https://github.com/forthefreeinternet/ichat",target:"_blank"}},[a("a-icon",{attrs:{type:"github"}})],1),a("a-icon",{staticClass:"tool-out icon",attrs:{type:"poweroff"},on:{click:e.logout}}),a("a-modal",{attrs:{title:"用户信息",visible:e.showUserModal,footer:""},on:{cancel:function(t){e.showUserModal=!1}}},[a("div",{staticClass:"tool-user"},[a("div",{staticClass:"tool-user-avatar",class:{active:e.showUpload||e.uploading},on:{mouseover:function(t){e.showUpload=!0},mouseleave:function(t){e.showUpload=!1}}},[a("a-avatar",{staticClass:"img",attrs:{src:e.user.avatar,size:120}}),e.showUpload&&!e.uploading?a("a-upload",{staticClass:"tool-user-upload",attrs:{"show-upload-list":!1,"before-upload":e.beforeUpload}},[a("div",{staticClass:"text"},[a("a-icon",{staticStyle:{"margin-right":"4px"},attrs:{type:"upload"}}),a("span",[e._v("更换头像")])],1)]):e._e(),e.uploading?a("a-icon",{staticClass:"loading",attrs:{type:"loading",spin:""}}):e._e()],1),a("div",{staticClass:"tool-user-info"},[a("div",{staticClass:"tool-user-title"},[e._v("更改用户名")]),a("a-input",{staticClass:"tool-user-input",attrs:{placeholder:"请输入用户名"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("a-button",{attrs:{type:"primary"},on:{click:e.changeUserName}},[e._v("确认")])],1),a("div",{staticClass:"tool-user-info"},[a("div",{staticClass:"tool-user-title"},[e._v("更改密码")]),a("a-input-password",{staticClass:"tool-user-input",attrs:{placeholder:"请输入密码"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("a-button",{attrs:{type:"primary"},on:{click:e.changePassword}},[e._v("确认")])],1)])]),a("a-modal",{attrs:{title:"主题",visible:e.showBackgroundModal,footer:""},on:{cancel:function(t){e.showBackgroundModal=!1}}},[a("div",{staticClass:"tool-user-info"},[a("div",{staticClass:"tool-user-title",staticStyle:{width:"65px"}},[a("span",[e._v("背景图")]),a("a-tooltip",{attrs:{placement:"topLeft","arrow-point-at-center":""}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("span",[e._v("输入空格时为默认背景, 支持 jpg, png, gif等格式")])]),a("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"exclamation-circle"}})],1)],1),a("a-input",{staticClass:"tool-user-input",attrs:{placeholder:"请输入背景图片网址"},model:{value:e.background,callback:function(t){e.background=t},expression:"background"}}),a("a-button",{attrs:{type:"primary"},on:{click:e.changeBackground}},[e._v("确认")])],1),a("div",{staticClass:"tool-recommend"},[a("div",{staticClass:"recommend",on:{click:function(t){return e.setBackground("https://images.weserv.nl/?url=https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/23fa890c0c244db1b2d6e0927113475c~tplv-k3u1fbpfcp-zoom-1.image?imageView2/2/w/800/q/85")}}},[a("img",{attrs:{src:"https://images.weserv.nl/?url=https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/23fa890c0c244db1b2d6e0927113475c~tplv-k3u1fbpfcp-zoom-1.image?imageView2/2/w/800/q/85",alt:""}}),a("span",{staticClass:"text"},[e._v("阿童木")])]),a("div",{staticClass:"recommend",on:{click:function(t){return e.setBackground("https://images.weserv.nl/?url=https://raw.githubusercontent.com/alexanderbast/vscode-snazzy/master/sample.jpg")}}},[a("img",{attrs:{src:"https://images.weserv.nl/?url=https://raw.githubusercontent.com/alexanderbast/vscode-snazzy/master/sample.jpg",alt:""}}),a("span",{staticClass:"text"},[e._v("VSCode摸鱼")])]),a("div",{staticClass:"recommend",on:{click:function(t){return e.setBackground("https://images.weserv.nl/?url=https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/453b8ebcdefa46a69c620da13f346ce2~tplv-k3u1fbpfcp-zoom-1.image?imageView2/2/w/800/q/85")}}},[a("img",{attrs:{src:"https://images.weserv.nl/?url=https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/453b8ebcdefa46a69c620da13f346ce2~tplv-k3u1fbpfcp-zoom-1.image?imageView2/2/w/800/q/85",alt:""}}),a("span",{staticClass:"text"},[e._v("山谷")])]),a("div",{staticClass:"recommend",on:{click:function(t){return e.setBackground("https://pic2.zhimg.com/v2-f76706d67343c66b08c937ec6bc42942_r.jpg?source=1940ef5c")}}},[a("img",{attrs:{src:"https://pic2.zhimg.com/v2-f76706d67343c66b08c937ec6bc42942_r.jpg?source=1940ef5c",alt:""}}),a("span",{staticClass:"text"},[e._v("云朵")])]),a("div",{staticClass:"recommend",on:{click:function(t){return e.setBackground("https://images.weserv.nl/?url=https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cc98cbc4ca284fc0aa509b12db0e325e~tplv-k3u1fbpfcp-zoom-1.image?imageView2/2/w/800/q/85")}}},[a("img",{attrs:{src:"https://images.weserv.nl/?url=https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cc98cbc4ca284fc0aa509b12db0e325e~tplv-k3u1fbpfcp-zoom-1.image?imageView2/2/w/800/q/85",alt:""}}),a("span",{staticClass:"text"},[e._v("少女")])]),a("div",{staticClass:"recommend",on:{click:function(t){return e.setBackground("https://picb.zhimg.com/v2-263525f6c912d300abfa0eed3acbfd4b_r.jpg")}}},[a("img",{attrs:{src:"https://picb.zhimg.com/v2-263525f6c912d300abfa0eed3acbfd4b_r.jpg",alt:""}}),a("span",{staticClass:"text"},[e._v("猫咪")])])])])],1)},p=[],g=(a("498a"),a("3fff")),m=a("4bb5"),h=a("cebe"),v=a.n(h),f=(a("d3b7"),a("a78e")),b=a.n(f),w=function(e){var t=b.a.get("token");return e.headers.token=t,e},y=function(e){return Promise.reject(e)},k=function(e){return e},j=function(e){return Promise.reject(e)},C="/api",I=v.a.create({timeout:6e4,baseURL:C,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});I.interceptors.request.use(w,y),I.interceptors.response.use(k,j);var _=I;function M(e){return _.get("/group/findByName?groupName=".concat(e))}var E=a("5530"),O=function(e){return _.patch("/user/username",Object(E["a"])({},e))},B=function(e,t){return _.patch("/user/password?password=".concat(t),Object(E["a"])({},e))};function G(e){return _.get("/user/findByName?username=".concat(e))}function R(e){return _.delete("/user",{params:e})}function x(e){return T.apply(this,arguments)}function T(){return T=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,_.get("/friend/friendMessages",{params:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),T.apply(this,arguments)}var S=a("48b8"),Q=(a("99af"),a("d54a").default),D={login:function(e){return Q.login(e)},getCVCode:function(){return 0},register:function(e){return Q.register(e)},getUserInfo:function(e){return request.get("".concat(API,"/user/userinfo?id=").concat(e))},preFetchUser:function(e){var t=e.type,a=e.q,s=e.page,r=e.pageSize;return request.get("".concat(API,"/user/prefetchuser?type=").concat(t,"&q=").concat(a,"&page=").concat(s,"&pageSize=").concat(r))},addNewFenzu:function(e){return request.post("".concat(API,"/user/addfenzu"),e)},modifyuserfenzu:function(e){return request.post("".concat(API,"/user/modifyuserfenzu"),e)},modifyFriendBeizhu:function(e){return request.post("".concat(API,"/user/modifyfriendbeizhu"),e)},deleteFenzu:function(e){return request.post("".concat(API,"/user/delfenzu"),e)},editFeznu:function(e){return request.post("".concat(API,"/user/editfenzu"),e)},setUserAvatar:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Q.setUserAvatar(e);case 2:return a=t.sent,t.abrupt("return",{msg:"修改头像成功",data:a});case 4:case"end":return t.stop()}}),t)})))()}},J=Object(m["a"])("app"),z=Object(m["a"])("chat"),U=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(n["a"])(this,a),e=t.apply(this,arguments),e.showUpload=!1,e.showUserModal=!1,e.showBackgroundModal=!1,e.username="",e.password="",e.background="",e.uploading=!1,e.avatar="",e}return Object(o["a"])(a,[{key:"userChange",value:function(){this.username=this.user.username,this.password=this.user.password}},{key:"created",value:function(){this.username=this.user.username,this.password=this.user.password}},{key:"logout",value:function(){this.$emit("logout")}},{key:"showUserInfo",value:function(){this.username=this.user.username,this.showUserModal=!0}},{key:"changeUserName",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Object(S["d"])(this.username)){e.next=2;break}return e.abrupt("return");case 2:return t=JSON.parse(JSON.stringify(this.user)),t.username=this.username,e.next=6,O(t);case 6:a=e.sent,s=Object(S["g"])(a),s&&(this.setUser(s),this.setUserGather(s),this.socket.emit("joinGroupSocket",{groupId:g["b"],userId:s.userId}));case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"changePassword",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(Object(S["f"])(this.password)){e.next=2;break}return e.abrupt("return");case 2:return t=JSON.parse(JSON.stringify(this.user)),e.next=5,B(t,this.password);case 5:a=e.sent,s=Object(S["g"])(a),s&&(this.setUser(s),this.setUserGather(s));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeUpload",value:function(e){var t="image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type||"image/gif"===e.type;if(!t)return this.$message.error("请上传jpeg/jpg/png/gif格式的图片!");var a=e.size/1024/1024<.5;return a?(this.avatar=e,this.handleUpload(),!1):this.$message.error("图片必须小于500K!")}},{key:"handleUpload",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.uploading=!0,t=new FormData,t.append("avatar",this.avatar),t.append("userId",this.user.userId),t.append("password",this.user.password),e.t0=S["g"],e.next=8,D.setUserAvatar(this.avatar);case 8:e.t1=e.sent,a=(0,e.t0)(e.t1),a&&(this.setUser(a),this.setUserGather(a),this.uploading=!1,this.showUpload=!1);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"changeBackground",value:function(){this.background.trim().length?this.setBackground(this.background):this.setBackground(g["a"]),this.showBackgroundModal=!1}}]),a}(l["c"]);Object(u["a"])([J.Getter("user")],U.prototype,"user",void 0),Object(u["a"])([J.Mutation("set_background")],U.prototype,"setBackground",void 0),Object(u["a"])([J.Mutation("set_user")],U.prototype,"setUser",void 0),Object(u["a"])([z.Getter("socket")],U.prototype,"socket",void 0),Object(u["a"])([z.Mutation("set_user_gather")],U.prototype,"setUserGather",void 0),Object(u["a"])([Object(l["d"])("user")],U.prototype,"userChange",null),U=Object(u["a"])([l["a"]],U);var F=U,N=F,Y=(a("4d51"),a("2877")),P=Object(Y["a"])(N,d,p,!1,null,"61837ae0",null),L=P.exports,W=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login"},[a("a-modal",{attrs:{header:"",footer:"",visible:e.showModal,closable:!1}},[a("a-tabs",{on:{change:e.changeType}},[a("a-tab-pane",{key:"login",attrs:{tab:"登录"}}),a("a-tab-pane",{key:"register",attrs:{tab:"注册","force-render":""}})],1),a("a-form",{staticClass:"login-form",attrs:{id:"components-form-demo-normal-login",form:e.form},on:{submit:e.handleSubmit}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["username",{rules:[{required:!0,message:"请输入用户名!"}]}],expression:"['username', { rules: [{ required: true, message: '请输入用户名!' }] }]"}],attrs:{placeholder:"username"}},[a("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"请输入密码!"}]}],expression:"['password', { rules: [{ required: true, message: '请输入密码!' }] }]"}],attrs:{type:"password",placeholder:"Password"}},[a("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),a("a-form-item",[a("a-checkbox",{directives:[{name:"decorator",rawName:"v-decorator",value:["remember",{valuePropName:"checked",initialValue:!1}],expression:"[\n            'remember',\n            {\n              valuePropName: 'checked',\n              initialValue: false,\n            },\n          ]"}]},[e._v(" 记住密码 ")]),a("a-button",{staticClass:"login-form-button",attrs:{type:"primary","html-type":"submit"}},[e._v(" "+e._s(e.buttonText)+" ")])],1)],1)],1)],1)},$=[],Z=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(n["a"])(this,a),e=t.apply(this,arguments),e.form=null,e.type="login",e.buttonText="登录",e}return Object(o["a"])(a,[{key:"created",value:function(){this.form=this.$form.createForm(this,{name:"normal_login"})}},{key:"changeType",value:function(e){this.type=e,"login"===this.type?this.buttonText="登录":"register"===this.type&&(this.buttonText="注册")}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),this.form.validateFields((function(e,a){if(!e){if("register"===t.type&&(a.createTime=(new Date).valueOf()),delete a.remember,!Object(S["d"])(a.username))return;t.$emit(t.type,a)}}))}}]),a}(l["c"]);Object(u["a"])([Object(l["b"])()],Z.prototype,"showModal",void 0),Z=Object(u["a"])([l["a"]],Z);var q=Z,H=q,V=(a("7cec"),Object(Y["a"])(H,W,$,!1,null,"3360a862",null)),K=V.exports,X=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.chatArr.length?s("div",{staticClass:"room"},e._l(e.chatArr,(function(t,r){return s("div",{key:(t.userId||t.groupId)+r},[t.groupId?s("div",{staticClass:"room-card",class:{active:e.activeRoom&&e.activeRoom.groupId===t.groupId},on:{click:function(a){return e.changeActiveRoom(t)}}},[s("a-badge",{staticClass:"room-card-badge",attrs:{count:e.unReadGather[t.groupId]}}),s("img",{staticClass:"room-card-type",attrs:{src:a("ec4d"),alt:""}}),s("div",{staticClass:"room-card-message"},[s("div",{staticClass:"room-card-name"},[e._v(e._s(t.groupName))]),t.messages?s("div",{staticClass:"room-card-new"},["text"===t.messages[t.messages.length-1].messageType?s("div",{staticClass:"text",domProps:{textContent:e._s(e._parseText(t.messages[t.messages.length-1].content))}}):e._e(),"image"===t.messages[t.messages.length-1].messageType?s("div",{staticClass:"image"},[e._v("[图片]")]):e._e()]):e._e()])],1):s("div",{staticClass:"room-card",class:{active:e.activeRoom&&!e.activeRoom.groupId&&e.activeRoom.userId===t.userId},on:{click:function(a){return e.changeActiveRoom(t)}}},[s("a-badge",{staticClass:"room-card-badge",attrs:{count:e.unReadGather[t.userId]}}),s("img",{staticClass:"room-card-type",class:{offLine:!e.activeUserGather.hasOwnProperty(t.userId)},attrs:{src:e.friendGather[t.userId].avatar,alt:""}}),s("div",{staticClass:"room-card-message"},[s("div",{staticClass:"room-card-name"},[e._v(e._s(t.username))]),t.messages?s("div",{staticClass:"room-card-new"},["text"===t.messages[t.messages.length-1].messageType?s("div",{staticClass:"text",domProps:{textContent:e._s(e._parseText(t.messages[t.messages.length-1].content))}}):e._e(),"image"===t.messages[t.messages.length-1].messageType?s("div",{staticClass:"image"},[e._v("[图片]")]):e._e()]):e._e()])],1)])})),0):e._e()},ee=[],te=(a("07ac"),a("2909")),ae=Object(m["a"])("chat"),se=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(n["a"])(this,a),e=t.apply(this,arguments),e.chatArr=[],e}return Object(o["a"])(a,[{key:"created",value:function(){this.sortChat()}},{key:"changeGroupGather",value:function(){this.sortChat()}},{key:"changeFriendGather",value:function(){this.sortChat()}},{key:"sortChat",value:function(){this.chatArr=[];var e=Object.values(this.groupGather),t=Object.values(this.friendGather);this.chatArr=[].concat(Object(te["a"])(e),Object(te["a"])(t)),this.chatArr=this.chatArr.sort((function(e,t){return e.messages&&t.messages?t.messages[t.messages.length-1].time-e.messages[e.messages.length-1].time:e.messages?-1:1}))}},{key:"changeActiveRoom",value:function(e){this.$emit("setActiveRoom",e),this.lose_unread_gather(e.groupId||e.userId)}},{key:"_parseText",value:function(e){return Object(S["e"])(e)}},{key:"activeUserGather",get:function(){return this.activeGroupUser[g["b"]]||{}}}]),a}(l["c"]);Object(u["a"])([ae.State("activeRoom")],se.prototype,"activeRoom",void 0),Object(u["a"])([ae.Getter("groupGather")],se.prototype,"groupGather",void 0),Object(u["a"])([ae.Getter("friendGather")],se.prototype,"friendGather",void 0),Object(u["a"])([ae.Getter("unReadGather")],se.prototype,"unReadGather",void 0),Object(u["a"])([ae.Getter("activeGroupUser")],se.prototype,"activeGroupUser",void 0),Object(u["a"])([ae.Mutation("lose_unread_gather")],se.prototype,"lose_unread_gather",void 0),Object(u["a"])([Object(l["d"])("groupGather",{deep:!0})],se.prototype,"changeGroupGather",null),Object(u["a"])([Object(l["d"])("friendGather",{deep:!0})],se.prototype,"changeFriendGather",null),se=Object(u["a"])([l["a"]],se);var re=se,ie=re,ne=(a("4b89"),Object(Y["a"])(ie,X,ee,!1,null,"02348a60",null)),oe=ne.exports,Ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"message"},[a("div",{staticClass:"message-header"},[a("div",{staticClass:"message-header-box"},[a("span",{staticClass:"message-header-text"},[e._v(e._s(e.chatName))]),e.dropped?a("a-icon",{staticClass:"message-header-icon",attrs:{type:"sync",spin:""}}):e._e(),e.groupGather[e.activeRoom.groupId]?a("genal-active",{attrs:{type:"group"}}):a("genal-active",{attrs:{type:"friend"}})],1)]),a("transition",{attrs:{name:"loading"}},[e.spinning&&!e.isNoData?a("div",{staticClass:"message-loading"},[a("a-icon",{staticClass:"message-loading-icon",attrs:{type:"sync",spin:""}})],1):e._e()]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isPreviewed,expression:"isPreviewed"}],class:"weui_dialog_confirm"},[a("div",{staticClass:"weui_mask"}),a("div",{staticClass:"weui_dialog"},[e._m(0),e._l(e.messageHash,(function(t){return a("div",{key:t,staticClass:"wrapper"},[a("div",{attrs:{id:"hero"}},[a("div",{attrs:{id:"output"}},[a("div",{attrs:{id:"progressBar"}}),a("div",{staticClass:"weui_progress"},[a("div",{staticClass:"weui_progress_bar"},[a("div",{staticClass:"weui_progress_inner_bar",style:{width:e.torrentProgress+"%"}})])])]),e.isImagePreviewed?a("div",{staticClass:"message-content-image",style:e.getImageStyle("$$"+e.imagePreviewed.width+"$"+e.imagePreviewed.height)},[a("viewer",{staticStyle:{display:"flex","align-items":"center"}},[a("img",{attrs:{src:e.imagePreviewed.blobURL,alt:""}})])],1):e._e(),a("div",{attrs:{id:"status"}},[a("div",[0==e.downloaded?a("span",{staticClass:"show-leech"},[e._v("Downloading ")]):e._e(),1==e.downloaded?a("span",{staticClass:"show-seed"},[e._v("Seeding ")]):e._e(),a("code",{attrs:{id:"streamedFileName"}},[e._v(e._s(e.streamedFileName))]),0==e.downloaded?a("span",{staticClass:"show-leech"},[e._v(" from ")]):e._e(),1==e.downloaded?a("span",{staticClass:"show-seed"},[e._v(" to ")]):e._e(),a("code",{attrs:{id:"numPeers"}},[e._v(e._s(e.numPeers))])]),a("div",[a("code",{attrs:{id:"downloaded"}},[e._v(e._s(e.downloadedBytes))]),e._v(" of "),a("code",{attrs:{id:"total"}},[e._v(e._s(e.totalBytes))]),e._v(" - "),a("span",{attrs:{id:"remaining"}},[e._v(e._s(e.remaining))])]),a("div",[e._v(" ↓ "),a("code",{attrs:{id:"downloadSpeed"}},[e._v(e._s(e.downloadSpeed))]),e._v(" / "),a("code",{attrs:{id:"uploadSpeed"}},[e._v(e._s(e.uploadSpeed))]),e._v(" ↑ ")])])])])})),a("div",{staticClass:"weui_dialog_ft"},[e.isPreviewed?a("a",{staticClass:"weui_btn_dialog default",attrs:{href:"javascript:;"},on:{click:function(t){return e.closeView()}}},[e._v("关闭")]):e._e(),a("a",{staticClass:"weui_btn_dialog primary",attrs:{href:"javascript:;"},on:{click:function(t){return e.downloadFile(e.fileMessage)}}},[e._v("另存为")])])],2)]),a("div",{staticClass:"message-main",style:{opacity:e.messageOpacity}},[a("div",{staticClass:"message-content"},[a("transition",{attrs:{name:"noData"}},[e.isNoData?a("div",{staticClass:"message-content-noData"},[e._v("没有更多消息了~")]):e._e()]),e._l(e.activeRoom.messages,(function(t){return[a("div",{key:t.userId+t.time,staticClass:"message-content-message",class:{"text-right":t.userId===e.user.userId}},[a("genal-avatar",{attrs:{data:t}}),a("div",[e._isUrl(t.content)?a("a",{staticClass:"message-content-text",attrs:{href:t.content,target:"_blank"}},[e._v(e._s(t.content))]):"text"===t.messageType?a("div",{staticClass:"message-content-text",domProps:{textContent:e._s(e._parseText(t.content))}}):e._e(),"file"===t.messageType?a("a",{staticClass:"message-content-text",attrs:{href:void 0,download:t.content.name},on:{click:function(a){return e.fetchFile(t)}}},[e._v(e._s(t.content.name))]):e._e(),e._e(),"image"===t.messageType?a("div",{staticClass:"message-content-image",style:e.getImageStyle("$"+t.content+"$"+t.width+"$"+t.height)},[a("viewer",{staticStyle:{display:"flex","align-items":"center"}},[a("img",{attrs:{src:t.dataURL,alt:""}})])],1):e._e()])],1)]}))],2)]),a("genal-input")],1)},ce=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"weui_dialog_hd"},[a("strong",{staticClass:"weui_dialog_title"},[e._v("预览")])])}],ue=(a("a434"),a("b0c0"),a("a9e3"),a("ac1f"),a("3ca3"),a("1276"),a("ddb0"),a("2b3d"),a("b85c")),le=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.userGather[e.data.userId]?a("div",{staticClass:"avatar"},[e.data.userId!==e.user.userId?a("a-popover",{attrs:{trigger:"click"}},[a("div",{staticClass:"avatar-card",attrs:{slot:"content"},slot:"content"},[a("a-avatar",{attrs:{size:60,src:e.userGather[e.data.userId].avatar}}),a("div",[e._v(e._s(e.userGather[e.data.userId].username))]),"admin"===e.user.role?a("a-button",{staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary"},on:{click:function(t){return e.deleteUser(e.data.userId)}}},[e._v(" 删除用户 ")]):e._e(),e.friendGather[e.data.userId]?a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e._setActiveRoom(e.data.userId)}}},[e._v("进入私聊")]):a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.addFriend(e.data.userId)}}},[e._v("添加好友")])],1),a("a-avatar",{staticClass:"avatar-img",attrs:{src:e.userGather[e.data.userId].avatar}})],1):a("a-avatar",{staticClass:"avatar-img",attrs:{src:e.userGather[e.data.userId].avatar}}),a("div",[a("span",{staticClass:"avatar-name"},[e._v(e._s(e.userGather[e.data.userId].username))]),e.showTime?a("span",{staticClass:"avatar-time"},[e._v(e._s(e._formatTime(e.data.time)))]):e._e()])],1):e._e()},de=[],pe=Object(m["a"])("chat"),ge=Object(m["a"])("app"),me=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(n["a"])(this,a),t.apply(this,arguments)}return Object(o["a"])(a,[{key:"addFriend",value:function(e){this.socket.emit("addFriend",{userId:this.user.userId,friendId:e,createTime:(new Date).valueOf()})}},{key:"_formatTime",value:function(e){return Object(S["a"])(e)}},{key:"deleteUser",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,R({uid:this.user.userId,psw:this.user.password,did:t});case 2:a=e.sent,Object(S["g"])(a);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_setActiveRoom",value:function(e){this.setActiveRoom(this.friendGather[e])}}]),a}(l["c"]);Object(u["a"])([Object(l["b"])()],me.prototype,"data",void 0),Object(u["a"])([Object(l["b"])({default:!0})],me.prototype,"showTime",void 0),Object(u["a"])([ge.Getter("user")],me.prototype,"user",void 0),Object(u["a"])([pe.Getter("userGather")],me.prototype,"userGather",void 0),Object(u["a"])([pe.Getter("friendGather")],me.prototype,"friendGather",void 0),Object(u["a"])([pe.Getter("socket")],me.prototype,"socket",void 0),Object(u["a"])([pe.Mutation("set_active_room")],me.prototype,"setActiveRoom",void 0),me=Object(u["a"])([l["a"]],me);var he=me,ve=he,fe=(a("0a4a"),Object(Y["a"])(ve,le,de,!1,null,"2265b892",null)),be=fe.exports,we=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"active"},["group"===e.type?a("div",[a("a-icon",{staticClass:"active-button",class:{heightLight:e.showGroupUser},attrs:{type:"team"},on:{click:e.toggleGroupUser}}),a("a-drawer",{attrs:{placement:"right",closable:!1,visible:e.showGroupUser,"get-container":e.getElement,"wrap-style":{position:"absolute"}},on:{close:e.toggleGroupUser}},[a("div",{staticClass:"active-content"},[a("div",{staticClass:"actiev-content-title"},[e._v("群聊管理")]),a("div",{staticClass:"active-content-sum"},[e._v("在线人数: "+e._s(e.activeNum))]),a("div",{staticClass:"active-content-users"},e._l(e.activeGroupUser[e.activeRoom.groupId],(function(t){return a("div",{key:t.userId,staticClass:"active-content-user"},[a("genal-avatar",{attrs:{data:t,showTime:!1}}),e._v(" "+e._s(t.username)+" ")],1)})),0),a("div",{staticClass:"primary"},[e._v(e._s(e.activeRoom.groupName+"&"+e.activeRoom.groupId+"&"+e.activeRoom.privateKey))]),a("a-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.activeRoom.groupName+"&"+e.activeRoom.groupId+"&"+e.activeRoom.privateKey,expression:"activeRoom.groupName + '&' + activeRoom.groupId + '&' + activeRoom.privateKey",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopy,expression:"onCopy",arg:"success"}],attrs:{type:"primary"}},[e._v("复制群链接")]),a("a-button",{staticClass:"active-content-out",attrs:{type:"danger"},on:{click:e.exitGroup}},[e._v("退出")])],1)])],1):a("div",[a("a-popconfirm",{attrs:{title:"确定要删除该好友吗？",placement:"bottomRight","ok-text":"Yes","cancel-text":"No"},on:{confirm:e.exitFriend}},[a("a-icon",{staticClass:"active-button",attrs:{type:"user-delete"}})],1)],1)])},ye=[],ke=(a("b64b"),Object(m["a"])("chat")),je=Object(m["a"])("app"),Ce=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(n["a"])(this,a),e=t.apply(this,arguments),e.showGroupUser=!1,e}return Object(o["a"])(a,[{key:"changeType",value:function(){"friend"===this.type&&(this.showGroupUser=!1)}},{key:"toggleGroupUser",value:function(){this.showGroupUser=!this.showGroupUser}},{key:"getElement",value:function(){return document.getElementsByClassName("message")[0]}},{key:"exitGroup",value:function(){this.socket.emit("exitGroup",{userId:this.user.userId,groupId:this.activeRoom.groupId})}},{key:"exitFriend",value:function(){this.socket.emit("exitFriend",{userId:this.user.userId,friendId:this.activeRoom.userId})}},{key:"onCopy",value:function(){this.$message.success("复制成功")}},{key:"activeNum",get:function(){return this.activeGroupUser[this.activeRoom.groupId]?Object.keys(this.activeGroupUser[this.activeRoom.groupId]).length:0}}]),a}(l["c"]);Object(u["a"])([Object(l["b"])({default:"group"})],Ce.prototype,"type",void 0),Object(u["a"])([je.Getter("user")],Ce.prototype,"user",void 0),Object(u["a"])([ke.State("activeRoom")],Ce.prototype,"activeRoom",void 0),Object(u["a"])([ke.State("socket")],Ce.prototype,"socket",void 0),Object(u["a"])([ke.Getter("activeGroupUser")],Ce.prototype,"activeGroupUser",void 0),Object(u["a"])([Object(l["d"])("type")],Ce.prototype,"changeType",null),Ce=Object(u["a"])([Object(l["a"])({components:{GenalAvatar:be}})],Ce);var Ie=Ce,_e=Ie,Me=(a("b6db"),Object(Y["a"])(_e,we,ye,!1,null,"c12866d8",null)),Ee=Me.exports,Oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.activeRoom?s("div",{staticClass:"message-input"},[s("a-popover",{staticClass:"message-popver",attrs:{placement:"topLeft",trigger:"hover"}},[s("template",{slot:"content"},[s("a-tabs",{attrs:{"default-key":"1",size:"small"}},[s("a-tab-pane",{key:"1",attrs:{tab:"Emoji"}},[s("genal-emoji",{on:{addEmoji:e.addEmoji}})],1),s("a-tab-pane",{key:"2",attrs:{tab:"工具"}},[s("div",{staticClass:"message-tool-item"},[s("a-upload",{attrs:{"show-upload-list":!1,"before-upload":e.beforeImgUpload}},[s("div",{staticClass:"message-tool-contant"},[s("img",{staticClass:"message-tool-item-img",attrs:{src:a("f6f0"),alt:""}}),s("div",{staticClass:"message-tool-item-text"},[e._v("图片")])])]),s("a-upload",{attrs:{"show-upload-list":!1,"before-upload":e.beforeFileUpload}},[s("div",{staticClass:"message-tool-contant"},[s("img",{staticClass:"message-tool-item-img",attrs:{src:a("71db"),alt:""}}),s("div",{staticClass:"message-tool-item-text"},[e._v("文件")])])])],1)])],1)],1),s("div",{staticClass:"messagte-tool-icon"},[e._v("😃")])],2),s("a-input",{ref:"input",staticStyle:{color:"#000"},attrs:{autocomplete:"off",type:"text",placeholder:"say hello...",autoFocus:""},on:{pressEnter:function(t){return e.throttle(e.preSendMessage)}},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),s("img",{staticClass:"message-input-button",attrs:{src:a("1959"),alt:""},on:{click:function(t){return e.throttle(e.preSendMessage)}}})],1):e._e()},Be=[],Ge=(a("c975"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"emoji-content"},[a("div",{staticClass:"emoji-content-item"},[a("span",{on:{click:function(t){return e.addEmoji("😃")}}},[e._v("😃")]),a("span",{on:{click:function(t){return e.addEmoji("😁")}}},[e._v("😁")]),a("span",{on:{click:function(t){return e.addEmoji("😂")}}},[e._v("😂")]),a("span",{on:{click:function(t){return e.addEmoji("😄")}}},[e._v("😄")]),a("span",{on:{click:function(t){return e.addEmoji("😅")}}},[e._v("😅")]),a("span",{on:{click:function(t){return e.addEmoji("😆")}}},[e._v("😆")]),a("span",{on:{click:function(t){return e.addEmoji("😇")}}},[e._v("😇")]),a("span",{on:{click:function(t){return e.addEmoji("😈")}}},[e._v("😈")]),a("span",{on:{click:function(t){return e.addEmoji("😉")}}},[e._v("😉")])]),a("div",{staticClass:"emoji-content-item"},[a("span",{on:{click:function(t){return e.addEmoji("😊")}}},[e._v("😊")]),a("span",{on:{click:function(t){return e.addEmoji("😋")}}},[e._v("😋")]),a("span",{on:{click:function(t){return e.addEmoji("😌")}}},[e._v("😌")]),a("span",{on:{click:function(t){return e.addEmoji("😍")}}},[e._v("😍")]),a("span",{on:{click:function(t){return e.addEmoji("😎")}}},[e._v("😎")]),a("span",{on:{click:function(t){return e.addEmoji("😏")}}},[e._v("😏")]),a("span",{on:{click:function(t){return e.addEmoji("😐")}}},[e._v("😐")]),a("span",{on:{click:function(t){return e.addEmoji("😒")}}},[e._v("😒")]),a("span",{on:{click:function(t){return e.addEmoji("😓")}}},[e._v("😓")])]),a("div",{staticClass:"emoji-content-item"},[a("span",{on:{click:function(t){return e.addEmoji("❓")}}},[e._v("❓")]),a("span",{on:{click:function(t){return e.addEmoji("😕")}}},[e._v("😕")]),a("span",{on:{click:function(t){return e.addEmoji("😖")}}},[e._v("😖")]),a("span",{on:{click:function(t){return e.addEmoji("😗")}}},[e._v("😗")]),a("span",{on:{click:function(t){return e.addEmoji("😘")}}},[e._v("😘")]),a("span",{on:{click:function(t){return e.addEmoji("😙")}}},[e._v("😙")]),a("span",{on:{click:function(t){return e.addEmoji("😚")}}},[e._v("😚")]),a("span",{on:{click:function(t){return e.addEmoji("😜")}}},[e._v("😜")]),a("span",{on:{click:function(t){return e.addEmoji("😝")}}},[e._v("😝")])]),a("div",{staticClass:"emoji-content-item"},[a("span",{on:{click:function(t){return e.addEmoji("😞")}}},[e._v("😞")]),a("span",{on:{click:function(t){return e.addEmoji("😟")}}},[e._v("😟")]),a("span",{on:{click:function(t){return e.addEmoji("😠")}}},[e._v("😠")]),a("span",{on:{click:function(t){return e.addEmoji("😡")}}},[e._v("😡")]),a("span",{on:{click:function(t){return e.addEmoji("😢")}}},[e._v("😢")]),a("span",{on:{click:function(t){return e.addEmoji("😣")}}},[e._v("😣")]),a("span",{on:{click:function(t){return e.addEmoji("😤")}}},[e._v("😤")]),a("span",{on:{click:function(t){return e.addEmoji("😥")}}},[e._v("😥")]),a("span",{on:{click:function(t){return e.addEmoji("😦")}}},[e._v("😦")])]),a("div",{staticClass:"emoji-content-item"},[a("span",{on:{click:function(t){return e.addEmoji("😨")}}},[e._v("😨")]),a("span",{on:{click:function(t){return e.addEmoji("😩")}}},[e._v("😩")]),a("span",{on:{click:function(t){return e.addEmoji("😪")}}},[e._v("😪")]),a("span",{on:{click:function(t){return e.addEmoji("😫")}}},[e._v("😫")]),a("span",{on:{click:function(t){return e.addEmoji("😬")}}},[e._v("😬")]),a("span",{on:{click:function(t){return e.addEmoji("😭")}}},[e._v("😭")]),a("span",{on:{click:function(t){return e.addEmoji("😮")}}},[e._v("😮")]),a("span",{on:{click:function(t){return e.addEmoji("😯")}}},[e._v("😯")]),a("span",{on:{click:function(t){return e.addEmoji("😰")}}},[e._v("😰")])]),a("div",{staticClass:"emoji-content-item"},[a("span",{on:{click:function(t){return e.addEmoji("😲")}}},[e._v("😲")]),a("span",{on:{click:function(t){return e.addEmoji("😳")}}},[e._v("😳")]),a("span",{on:{click:function(t){return e.addEmoji("😴")}}},[e._v("😴")]),a("span",{on:{click:function(t){return e.addEmoji("😵")}}},[e._v("😵")]),a("span",{on:{click:function(t){return e.addEmoji("🧐")}}},[e._v("🧐")]),a("span",{on:{click:function(t){return e.addEmoji("😷")}}},[e._v("😷")]),a("span",{on:{click:function(t){return e.addEmoji("🙁")}}},[e._v("🙁")]),a("span",{on:{click:function(t){return e.addEmoji("🙂")}}},[e._v("🙂")]),a("span",{on:{click:function(t){return e.addEmoji("🙃")}}},[e._v("🙃")])]),a("div",{staticClass:"emoji-content-item"},[a("span",{on:{click:function(t){return e.addEmoji("🤐")}}},[e._v("🤐")]),a("span",{on:{click:function(t){return e.addEmoji("🤑")}}},[e._v("🤑")]),a("span",{on:{click:function(t){return e.addEmoji("🤒")}}},[e._v("🤒")]),a("span",{on:{click:function(t){return e.addEmoji("🤓")}}},[e._v("🤓")]),a("span",{on:{click:function(t){return e.addEmoji("🤔")}}},[e._v("🤔")]),a("span",{on:{click:function(t){return e.addEmoji("🤕")}}},[e._v("🤕")]),a("span",{on:{click:function(t){return e.addEmoji("🤠")}}},[e._v("🤠")]),a("span",{on:{click:function(t){return e.addEmoji("🤡")}}},[e._v("🤡")]),a("span",{on:{click:function(t){return e.addEmoji("🤢")}}},[e._v("🤢")])]),a("div",{staticClass:"emoji-content-item"},[a("span",{on:{click:function(t){return e.addEmoji("🤤")}}},[e._v("🤤")]),a("span",{on:{click:function(t){return e.addEmoji("🤥")}}},[e._v("🤥")]),a("span",{on:{click:function(t){return e.addEmoji("🤧")}}},[e._v("🤧")]),a("span",{on:{click:function(t){return e.addEmoji("🤨")}}},[e._v("🤨")]),a("span",{on:{click:function(t){return e.addEmoji("🤩")}}},[e._v("🤩")]),a("span",{on:{click:function(t){return e.addEmoji("🤪")}}},[e._v("🤪")]),a("span",{on:{click:function(t){return e.addEmoji("🤫")}}},[e._v("🤫")]),a("span",{on:{click:function(t){return e.addEmoji("🤬")}}},[e._v("🤬")]),a("span",{on:{click:function(t){return e.addEmoji("🤭")}}},[e._v("🤭")])])])}),Re=[],xe=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(n["a"])(this,a),t.apply(this,arguments)}return Object(o["a"])(a,[{key:"addEmoji",value:function(e){this.$emit("addEmoji",e)}}]),a}(l["c"]);xe=Object(u["a"])([l["a"]],xe);var Te=xe,Se=Te,Qe=(a("745f"),Object(Y["a"])(Se,Ge,Re,!1,null,"032f2be1",null)),De=Qe.exports,Je=a("cfbb"),ze=Object(m["a"])("chat"),Ue=Object(m["a"])("app"),Fe=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(n["a"])(this,a),e=t.apply(this,arguments),e.text="",e.lastTime=0,e}return Object(o["a"])(a,[{key:"mounted",value:function(){this.initPaste()}},{key:"changeActiveRoom",value:function(){var e=this;this.$nextTick((function(){e.focusInput()}))}},{key:"initPaste",value:function(){var e=this;document.addEventListener("paste",(function(t){var a=t.clipboardData&&t.clipboardData.items,s=(window.URL||window.webkitURL,null);if(a&&a.length)for(var r=0;r<a.length;r++)if(-1!==a[r].type.indexOf("image")){s=a[r].getAsFile();break}s&&e.throttle(e.handleImgUpload,s)}))}},{key:"throttle",value:function(e,t){var a=+new Date;if(a-this.lastTime<500)return this.$message.error("消息发送太频繁！");e(t),this.lastTime=a}},{key:"preSendMessage",value:function(){this.text.trim()?this.text.length>220?this.$message.error("消息太长!"):(this.activeRoom.groupId?this.sendMessage({type:"group",message:this.text,messageType:"text"}):this.sendMessage({type:"friend",message:this.text,messageType:"text"}),this.text=""):this.$message.error("不能发送空消息!")}},{key:"sendMessage",value:function(e){"group"===e.type?Je["a"].sendGroupMessage({userId:this.user.userId,groupId:this.activeRoom.groupId,content:e.message,width:e.width,height:e.height,messageType:e.messageType}):this.socket.emit("friendMessage",{userId:this.user.userId,friendId:this.activeRoom.userId,content:e.message,width:e.width,height:e.height,messageType:e.messageType})}},{key:"addEmoji",value:function(e){var t=this.$refs.input.$el;if(t.selectionStart||"0"===t.selectionStart){var a=t.selectionStart,s=t.selectionEnd,r=t.scrollTop;this.text=this.text.substring(0,a)+e+this.text.substring(s,this.text.length),r>0&&(t.scrollTop=r),t.focus();var i=a+e.length;if(t.setSelectionRange)t.focus(),setTimeout((function(){t.setSelectionRange(i,i)}),10);else if(t.createTextRange){var n=t.createTextRange();n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",i),n.select()}}else this.text+=e,t.focus()}},{key:"focusInput",value:function(){this.mobile||this.$refs.input.focus()}},{key:"getImageSize",value:function(e){var t=e.width,a=e.height;return(t>335||a>335)&&(t>a?(a=a/t*335,t=335):(t=t/a*335,a=335)),{width:t,height:a}}},{key:"beforeImgUpload",value:function(e){return this.throttle(this.handleImgUpload,e),!1}},{key:"beforeFileUpload",value:function(e){return this.throttle(this.handleFileUpload,e),!1}},{key:"handleFileUpload",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:"application/pdf"===t.type||"application/msword"===t.type||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===t.type||"application/vnd.ms-powerpoint"===t.type||"application/vnd.openxmlformats-officedocument.presentationml.presentation"===t.type||"application/vnd.ms-excel"===t.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===t.type||"text/csv"===t.type,t.size/1024/1024<500,this.sendMessage({type:this.activeRoom.groupId?"group":"friend",message:t,width:void 0,height:void 0,messageType:"file"});case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleImgUpload",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,s,r,i,n,o,A=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a="image/jpeg"===t.type||"image/png"===t.type||"image/jpg"===t.type||"image/gif"===t.type,a){e.next=3;break}return e.abrupt("return",this.$message.error("请选择jpeg/jpg/png/gif格式的图片!"));case 3:if(s=t.size/1024/1024<3,s){e.next=10;break}return r=new Image,i=window.URL||window.webkitURL,r.src=i.createObjectURL(t),r.onload=function(){var e=A.getImageSize({width:r.width,height:r.height});A.sendMessage({type:A.activeRoom.groupId?"group":"friend",message:t,width:e.width,height:e.height,messageType:"file"})},e.abrupt("return");case 10:n=new Image,o=window.URL||window.webkitURL,n.src=o.createObjectURL(t),n.onload=function(){var e=A.getImageSize({width:n.width,height:n.height});A.sendMessage({type:A.activeRoom.groupId?"group":"friend",message:t,width:e.width,height:e.height,messageType:"image"})};case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),a}(l["c"]);Object(u["a"])([Ue.Getter("user")],Fe.prototype,"user",void 0),Object(u["a"])([Ue.Getter("mobile")],Fe.prototype,"mobile",void 0),Object(u["a"])([ze.State("activeRoom")],Fe.prototype,"activeRoom",void 0),Object(u["a"])([ze.Getter("socket")],Fe.prototype,"socket",void 0),Object(u["a"])([ze.Getter("dropped")],Fe.prototype,"dropped",void 0),Object(u["a"])([ze.Getter("groupGather")],Fe.prototype,"groupGather",void 0),Object(u["a"])([ze.Getter("userGather")],Fe.prototype,"userGather",void 0),Object(u["a"])([Object(l["d"])("activeRoom")],Fe.prototype,"changeActiveRoom",null),Fe=Object(u["a"])([Object(l["a"])({components:{GenalEmoji:De}})],Fe);var Ne=Fe,Ye=Ne,Pe=(a("7e05"),Object(Y["a"])(Ye,Oe,Be,!1,null,"8ff767a6",null)),Le=Pe.exports,We=a("5b74"),$e={getRecentNews:function(e){var t=e.roomid,a=e.page,s=e.pageSize;return request.get("".concat(API,"/news/recent?roomid=").concat(t,"&page=").concat(a,"&pageSize=").concat(s))},getLastNews:function(e){return request.post("".concat(API,"/news/last"),e)},userIsReadMsg:function(e){return request.post("".concat(API,"/news/isread"),e)},getHistoryMsg:function(e){return request.post("".concat(API,"/news/historymsg"),e)},fetchFile:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,We["a"].fetchFile(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},fetchProgress:function(e){return We["a"].fetchProgress(e)}},Ze=a("94df"),qe=a.n(Ze),He=a("c32d"),Ve=a.n(He),Ke=Object(m["a"])("chat"),Xe=Object(m["a"])("app"),et=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(n["a"])(this,a),e=t.apply(this,arguments),e.text="",e.needScrollToBottom=!0,e.messageOpacity=1,e.lastMessagePosition=0,e.spinning=!1,e.pageSize=30,e.isNoData=!1,e.lastTime=0,e.isPreviewed=!1,e.files={},e.messageHash={},e.hasPreviewed={},e.torrentProgress=0,e.streamedFileName="",e.downloaded=!1,e.numPeers="0 peers",e.downloadedBytes="",e.totalBytes="",e.downloadSpeed="0 b/s",e.uploadSpeed="0 b/s",e.remaining="",e.isImagePreviewed=!1,e}return Object(o["a"])(a,[{key:"mounted",value:function(){this.messageDom=document.getElementsByClassName("message-main")[0],this.messageContentDom=document.getElementsByClassName("message-content")[0],this.headerDom=document.getElementsByClassName("message-header-text")[0],this.messageDom.addEventListener("scroll",this.handleScroll),this.scrollToBottom()}},{key:"changeActiveRoom",value:function(){var e=this;this.messageOpacity=0,this.isNoData=!1,this.headerDom&&(this.headerDom.classList.add("transition"),setTimeout((function(){e.headerDom.classList.remove("transition")}),400)),this.activeRoom.messages&&this.activeRoom.messages.length>30&&(this.activeRoom.messages=this.activeRoom.messages.splice(this.activeRoom.messages.length-30,30)),this.scrollToBottom()}},{key:"changeMessages",value:function(){this.needScrollToBottom&&this.addMessage(),this.needScrollToBottom=!0}},{key:"connectingSocket",value:function(){this.socket.disconnected&&this.set_dropped(!0)}},{key:"addMessage",value:function(){if(this.activeRoom.messages){var e=this.activeRoom.messages;(e[e.length-1].userId===this.user.userId||this.messageDom&&this.messageDom.scrollTop+this.messageDom.offsetHeight+100>this.messageContentDom.scrollHeight)&&this.scrollToBottom()}}},{key:"handleScroll",value:function(e){if(e.currentTarget&&0===this.messageDom.scrollTop){this.lastMessagePosition=this.messageContentDom.offsetHeight;var t=this.activeRoom.messages;t&&t.length>=this.pageSize&&!this.spinning&&this.getMoreMessage()}}},{key:"throttle",value:function(e,t){var a=+new Date;if(a-this.lastTime<1e3)return this.$message.error("消息获取太频繁！");e(t),this.lastTime=a}},{key:"getMoreMessage",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.isNoData){e.next=2;break}return e.abrupt("return",!1);case 2:if(this.spinning=!0,!this.activeRoom.groupId){e.next=8;break}return e.next=6,this.getGroupMessages();case 6:e.next=10;break;case 8:return e.next=10,this.getFriendMessages();case 10:this.$nextTick((function(){t.messageDom.scrollTop=t.messageContentDom.offsetHeight-t.lastMessagePosition,t.spinning=!1,t.messageOpacity=1}));case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getGroupMessages",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,s,r,i,n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.activeRoom.groupId,a=this.activeRoom.messages.length,s=this.activeRoom.messages?this.activeRoom.messages:[],e.t0=S["g"],e.next=6,Je["a"].getGroupMessages({groupId:t,current:a,pageSize:this.pageSize});case 6:if(e.t1=e.sent,r=(0,e.t0)(e.t1),r){(!r.messageArr.length||r.messageArr.length<this.pageSize)&&(this.isNoData=!0),this.needScrollToBottom=!1,this.set_group_messages([].concat(Object(te["a"])(r.messageArr),Object(te["a"])(s))),i=Object(ue["a"])(r.userArr);try{for(i.s();!(n=i.n()).done;)o=n.value,this.userGather[o.userId]||this.set_user_gather(o)}catch(A){i.e(A)}finally{i.f()}}case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFriendMessages",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,s,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.user.userId,a=this.activeRoom.userId,s=this.activeRoom.messages.length,r=this.activeRoom.messages?this.activeRoom.messages:[],e.t0=S["g"],e.next=7,x({userId:t,friendId:a,current:s,pageSize:this.pageSize});case 7:e.t1=e.sent,i=(0,e.t0)(e.t1),i&&((!i.messageArr.length||i.messageArr.length<this.pageSize)&&(this.isNoData=!0),this.needScrollToBottom=!1,this.set_friend_messages([].concat(Object(te["a"])(i.messageArr),Object(te["a"])(r))));case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"scrollToBottom",value:function(){var e=this;this.$nextTick((function(){e.messageDom.scrollTop=e.messageDom.scrollHeight,e.messageOpacity=1}))}},{key:"getImageURL",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=new FileReader;try{t.content.blob&&(s.readAsDataURL(t.content.blob),s.onload=function(){a=this.result},s.onerror=function(){})}catch(r){}return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getImageStyle",value:function(e){var t=e.split("$"),a=Number(t[2]),s=Number(t[3]);return this.mobile&&a>138?(s=138*s/a,a=138,{width:"".concat(a+12,"px"),height:"".concat(s+12,"px")}):{width:"".concat(a+12,"px"),height:"".concat(s+12,"px")}}},{key:"_parseText",value:function(e){return Object(S["e"])(e)}},{key:"_isUrl",value:function(e){return Object(S["c"])(e)}},{key:"fetchFile",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=function(){var e=$e.fetchProgress(t);s(e)},this.messageHash[t.hash]=t.hash,this.streamedFileName=t.content.name,this.isPreviewed=!0,this.fileMessage=t,e.next=8,$e.fetchFile(t);case 8:a=e.sent,this.streamedFileName=a.name,this.files[t.hash]=a,this.hasPreviewed[t.hash],this.hasPreviewed[t.hash]=!0,t.content.name.split(".")[t.content.name.split(".").length-1],this.isImagePreviewed=!1,a.appendTo("#output"),s=this.updateStat,this.downloadStatistic=setInterval(r,1e3),r();case 20:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateStat",value:function(e){this.numPeers=e.numPeers+(1===e.numPeers?" peer":" peers"),this.torrentProgress=Math.round(100*e.progress*100)/100,this.downloadedBytes=qe()(e.downloaded),this.totalBytes=qe()(e.length),e.done||e.downloaded==e.length?(this.remaining="Done",this.downloaded=!0):(this.remaining=Ve.a.duration(e.timeRemaining/1e3,"seconds").humanize(),this.remaining=this.remaining[0].toUpperCase()+this.remaining.substring(1)+" remaining"),this.downloadSpeed=qe()(e.downloadSpeed)+"/s",this.uploadSpeed=qe()(e.uploadSpeed)+"/s"}},{key:"downloadFile",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.files[t.hash]){e.next=4;break}this.files[t.hash].getBlobURL((function(e,s){var r=document.createElement("a");r.href=s,r.download=a.files[t.hash].name,r.click(),URL.revokeObjectURL(s)})),e.next=7;break;case 4:return e.next=6,this.fetchFile(t);case 6:this.downloadFile(t);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"closeView",value:function(){this.isPreviewed=!1,this.messageHash={},clearInterval(this.downloadStatistic),this.torrentProgress=0,this.streamedFileName="",this.downloaded=!1,this.numPeers="0 peers",this.downloadedBytes="",this.totalBytes="",this.downloadSpeed="0 b/s",this.uploadSpeed="0 b/s",this.remaining=""}},{key:"chatName",get:function(){return this.groupGather[this.activeRoom.groupId]?this.groupGather[this.activeRoom.groupId].groupName:this.userGather[this.activeRoom.userId].username}}]),a}(l["c"]);Object(u["a"])([Xe.Getter("user")],et.prototype,"user",void 0),Object(u["a"])([Xe.Getter("mobile")],et.prototype,"mobile",void 0),Object(u["a"])([Ke.State("activeRoom")],et.prototype,"activeRoom",void 0),Object(u["a"])([Ke.Getter("socket")],et.prototype,"socket",void 0),Object(u["a"])([Ke.Getter("dropped")],et.prototype,"dropped",void 0),Object(u["a"])([Ke.Getter("groupGather")],et.prototype,"groupGather",void 0),Object(u["a"])([Ke.Getter("userGather")],et.prototype,"userGather",void 0),Object(u["a"])([Ke.Mutation("set_dropped")],et.prototype,"set_dropped",void 0),Object(u["a"])([Ke.Mutation("set_group_messages")],et.prototype,"set_group_messages",void 0),Object(u["a"])([Ke.Mutation("set_friend_messages")],et.prototype,"set_friend_messages",void 0),Object(u["a"])([Ke.Mutation("set_user_gather")],et.prototype,"set_user_gather",void 0),Object(u["a"])([Object(l["d"])("activeRoom")],et.prototype,"changeActiveRoom",null),Object(u["a"])([Object(l["d"])("activeRoom.messages",{deep:!0})],et.prototype,"changeMessages",null),Object(u["a"])([Object(l["d"])("socket.disconnected")],et.prototype,"connectingSocket",null),et=Object(u["a"])([Object(l["a"])({components:{GenalActive:Ee,GenalAvatar:be,GenalInput:Le}})],et);var tt=et,at=tt,st=(a("8d4d"),a("b244"),Object(Y["a"])(at,Ae,ce,!1,null,"5e7ea6fc",null)),rt=st.exports,it=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"search"},[a("div",{staticClass:"search-select"},[a("a-select",{attrs:{"show-search":"",placeholder:"搜索","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null},on:{search:e.handleSearch}},e._l(e.searchData,(function(t,s){return a("a-select-option",{key:s,on:{click:function(a){return e.selectChat(t)}}},[t.username?a("div",[e._v(e._s(t.username))]):e._e(),t.groupName?a("div",[e._v(e._s(t.groupName))]):e._e()])})),1),a("a-dropdown",{staticClass:"search-dropdown"},[a("a-icon",{staticClass:"search-dropdown-button",attrs:{type:"plus-circle"}}),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",[a("div",{on:{click:function(){return e.visibleAddGroup=!e.visibleAddGroup}}},[e._v("创建群")])]),a("a-menu-item",[a("div",{on:{click:function(){return e.visibleJoinGroup=!e.visibleJoinGroup}}},[e._v("查找群")])]),a("a-menu-item",[a("div",{on:{click:function(){return e.visibleAddFriend=!e.visibleAddFriend}}},[e._v("查找用户")])])],1)],1)],1),a("a-modal",{attrs:{footer:"",title:"创建群"},model:{value:e.visibleAddGroup,callback:function(t){e.visibleAddGroup=t},expression:"visibleAddGroup"}},[a("div",{staticStyle:{display:"flex"}},[a("a-input",{attrs:{placeholder:"请输入群名字"},model:{value:e.groupName,callback:function(t){e.groupName=t},expression:"groupName"}}),a("a-button",{attrs:{type:"primary"},on:{click:e.addGroup}},[e._v("确定")])],1)]),a("a-modal",{attrs:{footer:"",title:"搜索群"},model:{value:e.visibleJoinGroup,callback:function(t){e.visibleJoinGroup=t},expression:"visibleJoinGroup"}},[e.visibleJoinGroup?a("div",{staticStyle:{display:"flex"}},[a("a-select",{staticStyle:{width:"90%"},attrs:{"show-search":"",placeholder:"请输入群名字","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null},on:{search:e.handleGroupSearch,change:e.handleGroupChange}},e._l(e.groupArr,(function(t,s){return a("a-select-option",{key:s,on:{click:function(a){return e.handleGroupSelect(t)}}},[a("div",[e._v(e._s(t.groupName))])])})),1),a("a-button",{attrs:{type:"primary"},on:{click:e.joinGroup}},[e._v("加入群")])],1):e._e()]),a("a-modal",{attrs:{footer:"",title:"搜索用户"},model:{value:e.visibleAddFriend,callback:function(t){e.visibleAddFriend=t},expression:"visibleAddFriend"}},[e.visibleAddFriend?a("div",{staticStyle:{display:"flex"}},[a("a-select",{staticStyle:{width:"90%"},attrs:{"show-search":"",placeholder:"请输入用户名","default-active-first-option":!1,"show-arrow":!1,"filter-option":!1,"not-found-content":null},on:{search:e.handleUserSearch,change:e.handleUserChange}},e._l(e.userArr,(function(t,s){return a("a-select-option",{key:s,on:{click:function(a){return e.handleUserSelect(t)}}},[a("div",[e._v(e._s(t.username))])])})),1),a("a-button",{attrs:{type:"primary"},on:{click:e.addFriend}},[e._v("添加好友")])],1):e._e()])],1)},nt=[],ot=Object(m["a"])("chat"),At=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(n["a"])(this,a),e=t.apply(this,arguments),e.visibleAddGroup=!1,e.visibleJoinGroup=!1,e.visibleAddFriend=!1,e.groupName="",e.searchData=[],e.groupId="",e.groupArr=[],e.friendId="",e.userArr=[],e}return Object(o["a"])(a,[{key:"created",value:function(){this.getSearchData()}},{key:"changeGroupGather",value:function(){this.getSearchData()}},{key:"changeFriendGather",value:function(){this.getSearchData()}},{key:"getSearchData",value:function(){this.searchData=[].concat(Object(te["a"])(Object.values(this.groupGather)),Object(te["a"])(Object.values(this.friendGather)))}},{key:"handleSearch",value:function(e){var t=[];this.searchData=[].concat(Object(te["a"])(Object.values(this.groupGather)),Object(te["a"])(Object.values(this.friendGather)));var a,s=Object(ue["a"])(this.searchData);try{for(s.s();!(a=s.n()).done;){var r=a.value;r.username?Object(S["b"])(e,r.username)&&t.push(r):Object(S["b"])(e,r.groupName)&&t.push(r)}}catch(i){s.e(i)}finally{s.f()}this.searchData=t}},{key:"handleGroupSearch",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return this.groupId=t,e.next=6,M(t);case 6:a=e.sent,s=Object(S["g"])(a),this.groupArr=s;case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleGroupSelect",value:function(e){this.groupId=e.groupId}},{key:"handleGroupChange",value:function(){this.groupArr=[]}},{key:"handleUserSearch",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,G(t);case 4:a=e.sent,s=Object(S["g"])(a),this.userArr=s;case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleUserSelect",value:function(e){this.friendId=e.userId}},{key:"handleUserChange",value:function(){this.userArr=[]}},{key:"selectChat",value:function(e){this.$emit("setActiveRoom",e)}},{key:"addGroup",value:function(){this.visibleAddGroup=!1,Object(S["d"])(this.groupName)?(this.$emit("addGroup",this.groupName),this.groupName=""):this.visibleAddGroup=!0}},{key:"joinGroup",value:function(){this.visibleJoinGroup=!1,this.$emit("joinGroup",this.groupId),this.groupId=""}},{key:"addFriend",value:function(){this.visibleAddFriend=!1,this.$emit("addFriend",this.friendId),this.friendId=""}}]),a}(l["c"]);Object(u["a"])([ot.State("activeRoom")],At.prototype,"activeRoom",void 0),Object(u["a"])([ot.Getter("groupGather")],At.prototype,"groupGather",void 0),Object(u["a"])([ot.Getter("friendGather")],At.prototype,"friendGather",void 0),Object(u["a"])([Object(l["d"])("groupGather")],At.prototype,"changeGroupGather",null),Object(u["a"])([Object(l["d"])("friendGather")],At.prototype,"changeFriendGather",null),At=Object(u["a"])([l["a"]],At);var ct=At,ut=ct,lt=(a("346b"),Object(Y["a"])(ut,it,nt,!1,null,"2d902875",null)),dt=lt.exports,pt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.mobile?e._e():a("div",{staticClass:"music"})},gt=[],mt=Object(m["a"])("app"),ht=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){return Object(n["a"])(this,a),t.apply(this,arguments)}return a}(l["c"]);Object(u["a"])([mt.Getter("mobile")],ht.prototype,"mobile",void 0),ht=Object(u["a"])([l["a"]],ht);var vt=ht,ft=vt,bt=(a("651c"),Object(Y["a"])(ft,pt,gt,!1,null,"11935f15",null)),wt=bt.exports,yt=Object(m["a"])("app"),kt=Object(m["a"])("chat"),jt=function(e){Object(A["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(n["a"])(this,a),e=t.apply(this,arguments),e.showModal=!1,e.visibleDrawer=!1,e.visibleTool=!0,e}return Object(o["a"])(a,[{key:"created",value:function(){this.user.userId?this.handleJoin():this.showModal=!0}},{key:"handleLogin",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.login(t);case 2:a=e.sent,a&&this.handleJoin();case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleRegister",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.register(t);case 2:a=e.sent,a&&this.handleJoin();case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleJoin",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.showModal=!1,this.connectSocket();case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"addGroup",value:function(e){Je["a"].addGroup({userId:this.user.userId,groupName:e,createTime:(new Date).valueOf()})}},{key:"joinGroup",value:function(e){Je["a"].serverJoinGroup({userId:this.user.userId,groupId:e})}},{key:"addFriend",value:function(e){this.socket.emit("addFriend",{userId:this.user.userId,friendId:e,createTime:(new Date).valueOf()})}},{key:"setActiveRoom",value:function(e){this._setActiveRoom(e)}},{key:"logout",value:function(){this.clearUser(),this.$router.go(0)}},{key:"toggleDrawer",value:function(){this.visibleDrawer=!this.visibleDrawer}},{key:"toggleTool",value:function(){this.visibleTool=!this.visibleTool}}]),a}(l["c"]);Object(u["a"])([yt.Getter("user")],jt.prototype,"user",void 0),Object(u["a"])([yt.Mutation("clear_user")],jt.prototype,"clearUser",void 0),Object(u["a"])([yt.Action("login")],jt.prototype,"login",void 0),Object(u["a"])([yt.Action("register")],jt.prototype,"register",void 0),Object(u["a"])([yt.Getter("background")],jt.prototype,"background",void 0),Object(u["a"])([kt.Getter("socket")],jt.prototype,"socket",void 0),Object(u["a"])([kt.Getter("userGather")],jt.prototype,"userGather",void 0),Object(u["a"])([kt.Getter("groupGather")],jt.prototype,"groupGather",void 0),Object(u["a"])([kt.Getter("activeRoom")],jt.prototype,"activeRoom",void 0),Object(u["a"])([kt.Mutation("set_active_room")],jt.prototype,"_setActiveRoom",void 0),Object(u["a"])([kt.Action("connectSocket")],jt.prototype,"connectSocket",void 0),jt=Object(u["a"])([Object(l["a"])({components:{GenalTool:L,GenalJoin:K,GenalRoom:oe,GenalMessage:rt,GenalSearch:dt,GenalMusic:wt}})],jt);var Ct=jt,It=Ct,_t=(a("c0c8"),Object(Y["a"])(It,s,r,!1,null,"9ed25f14",null));t["default"]=_t.exports},f5a3:function(e,t,a){},f6f0:function(e,t,a){e.exports=a.p+"img/photo.ce81806c.png"},ffb1:function(e,t,a){}}]);